<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WEIC Sunday School Registration 2025–26</title>
<style>
body { font-family: Arial; background: #f4f4f4; padding: 20px; }
h1,h2 { background: #00695c; color: white; padding: 10px; }
.section { background: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
label { display: block; margin-top: 10px; }
input, select { width: 100%; padding: 6px; margin-top: 4px; }
button { margin-top: 20px; padding: 10px 15px; background: #00695c; color: white; border: none; cursor: pointer; }
button:hover { background: #004d40; }
.error { color:red; font-weight:bold; margin-top:5px; }
#assignedLevel { margin-top:10px; font-weight:bold; color:#00695c; }

/* Success message at bottom */
#successMessage {
    display: none;
    padding: 12px;
    margin-top: 20px;
    background: #c8e6c9;
    color: #256029;
    font-weight: bold;
    border: 1px solid #256029;
    border-radius: 5px;
    text-align: center;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
}
</style>
</head>
<body>

<h1>WEIC Sunday School Registration Form 2025–26</h1>

<form id="registrationForm" novalidate>

<div class="section">
<h2>Child Information</h2>
<label>Child Name *</label>
<input type="text" id="childName" required>
<p id="childNameError" class="error"></p>

<label>Gender *</label>
<select id="gender" required>
<option value="">Select</option>
<option>Male</option>
<option>Female</option>
</select>

<label>Date of Birth *</label>
<input type="date" id="dob" required>

<label>Age *</label>
<input type="number" id="age" readonly required>
<p id="ageMessage" class="error"></p>
<p id="assignedLevel"></p>

<label>Allergies</label>
<input type="text" id="allergies">
</div>

<div class="section">
<h2>Parent Information</h2>
<label>Father's Name *</label>
<input type="text" id="fatherName" required>
<p id="fatherNameError" class="error"></p>

<label>Mother's Name *</label>
<input type="text" id="motherName" required>
<p id="motherNameError" class="error"></p>

<label>Mailing Address *</label>
<input type="text" id="address" required>

<label>Email Address *</label>
<input type="email" id="email1" required>
<p id="email1Error" class="error"></p>

<label>Secondary Email</label>
<input type="email" id="email2">
<p id="email2Error" class="error"></p>

<label>Father's Phone *</label>
<input type="text" id="fatherPhone" required placeholder="123-456-7890">
<p id="fatherPhoneError" class="error"></p>

<label>Mother's Phone *</label>
<input type="text" id="motherPhone" required placeholder="123-456-7890">
<p id="motherPhoneError" class="error"></p>
</div>

<div class="section">
<h2>Emergency Contacts</h2>
<label>Emergency Contact 1 Name *</label>
<input type="text" id="emergency1Name" required>
<p id="emergency1NameError" class="error"></p>

<label>Emergency Contact 1 Phone *</label>
<input type="text" id="emergency1Phone" required placeholder="123-456-7890">
<p id="emergency1PhoneError" class="error"></p>

<label>Emergency Contact 2 Name *</label>
<input type="text" id="emergency2Name" required>
<p id="emergency2NameError" class="error"></p>

<label>Emergency Contact 2 Phone *</label>
<input type="text" id="emergency2Phone" required placeholder="123-456-7890">
<p id="emergency2PhoneError" class="error"></p>
</div>

<div class="section">
<h2>Permissions & Agreements</h2>
<label>Photo/Video Consent *</label>
<select id="photoConsent" required>
<option value="">Select</option>
<option>Yes</option>
<option>No</option>
</select>

<label>Pickup Authorization *</label>
<select id="pickupConsent" required>
<option value="">Select</option>
<option>Yes</option>
<option>No</option>
</select>

<label>Liability Release *</label>
<select id="liability" required>
<option value="">Select</option>
<option>Yes</option>
<option>No</option>
</select>

<label>Scholarship Requested *</label>
<select id="scholarship" required>
<option value="">Select</option>
<option>Yes</option>
<option>No</option>
</select>

<label>Electronic Signature *</label>
<input type="text" id="signature" required>
<p id="signatureError" class="error"></p>
</div>

<button type="submit">Submit Registration</button>
</form>

<div id="successMessage">Form successfully submitted!</div>

<script>
function isLetters(str){ return /^[A-Za-z\s]+$/.test(str); }
function isPhone(num){ return /^\d{3}-\d{3}-\d{4}$/.test(num); }
function isEmailValid(email){ return /^[^\s@]+@[^\s@]+\.(com|org|edu)$/.test(email); }

const dobInput = document.getElementById("dob");
const ageInput = document.getElementById("age");
const ageMessage = document.getElementById("ageMessage");
const assignedLevel = document.getElementById("assignedLevel");
const submitButton = document.querySelector("button[type='submit']");
const successMessage = document.getElementById("successMessage");

function calculateLevel(age){ return "Level " + (age - 4); }

dobInput.addEventListener("change", () => {
    const dob = new Date(dobInput.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    if(today < new Date(today.getFullYear(), dob.getMonth(), dob.getDate())) age--;
    ageInput.value = age;

    if(age < 5){ ageMessage.textContent="Too Young — cannot apply"; assignedLevel.textContent=""; submitButton.disabled=true; }
    else if(age > 11){ ageMessage.textContent="Too Old — too late"; assignedLevel.textContent=""; submitButton.disabled=true; }
    else{ ageMessage.textContent=""; assignedLevel.textContent="Assigned Level: "+calculateLevel(age); submitButton.disabled=false; }
});

// Phone auto-format
["fatherPhone","motherPhone","emergency1Phone","emergency2Phone"].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener("input", e=>{
        let val = el.value.replace(/\D/g,'');
        if(val.length>3 && val.length<=6) val=val.slice(0,3)+"-"+val.slice(3);
        else if(val.length>6) val=val.slice(0,3)+"-"+val.slice(3,6)+"-"+val.slice(6,10);
        el.value = val;
    });
});

// Form submission
document.getElementById("registrationForm").addEventListener("submit", e=>{
    e.preventDefault();
    let valid = true;

    ["childName","fatherName","motherName","emergency1Name","emergency2Name","signature"].forEach(id=>{
        const v=document.getElementById(id).value.trim();
        const err=document.getElementById(id+"Error");
        if(!isLetters(v)){ err.textContent="Please use letters only"; valid=false; } else err.textContent="";
    });

    ["fatherPhone","motherPhone","emergency1Phone","emergency2Phone"].forEach(id=>{
        const v=document.getElementById(id).value.trim();
        const err=document.getElementById(id+"Error");
        if(!isPhone(v)){ err.textContent="Enter valid phone (123-456-7890)"; valid=false; } else err.textContent="";
    });

    ["email1","email2"].forEach(id=>{
        const v=document.getElementById(id).value.trim();
        const err=document.getElementById(id+"Error");
        if(v && !isEmailValid(v)){ err.textContent="Email must end with .com, .org, or .edu"; valid=false; } else err.textContent="";
    });

    if(!valid) return;

    const childData = { Name: document.getElementById("childName").value.trim(), Age: parseInt(ageInput.value) };

    fetch("/submit",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ Children:[childData] })
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.error){ alert(data.error); return; }
        assignedLevel.textContent="Assigned Level: "+data.level;
        successMessage.style.display="block";
        setTimeout(()=>{ successMessage.style.display="none"; },4000);
        document.getElementById("registrationForm").reset();
        ageInput.value="";
        assignedLevel.textContent="";
    })
    .catch(err=>{ console.error(err); alert("Error submitting form. Try again."); });
});
</script>

</body>
</html>
